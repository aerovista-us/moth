<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Performance Optimizations -->
    <link rel="preload" href="mystical-styles.min.css" as="style">
    <link rel="preload" href="js/bundle.min.js" as="script">
    <link rel="preload" href="favicon.svg" as="image">
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#6b46c1">
    <meta name="color-scheme" content="dark light">
    <meta name="format-detection" content="telephone=no">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü¶ã Moth Emporium Presents, Nailed IT Business Planning Suite</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="mystical-styles.css">
    <style>
        .analytics-dashboard {
            background: white;
            border: 2px solid var(--brand-purple);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .analytics-card {
            background: var(--brand-pink-accent);
            border: 2px solid var(--brand-purple);
            border-radius: 15px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .analytics-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(107, 70, 193, 0.3);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .card-icon {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--brand-purple), var(--brand-dusty-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--brand-black);
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--brand-purple);
            margin: 0.5rem 0;
        }
        
        .metric-label {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .metric-change {
            font-size: 0.8rem;
            font-weight: bold;
            margin-top: 0.5rem;
        }
        
        .metric-change.positive {
            color: #10b981;
        }
        
        .metric-change.negative {
            color: #ef4444;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            border: 2px dashed var(--brand-purple);
        }
        
        .usage-table {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        
        .table-header {
            font-weight: bold;
            color: var(--brand-black);
            margin-bottom: 1rem;
        }
        
        .usage-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .usage-row:last-child {
            border-bottom: none;
        }
        
        .usage-page {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .usage-icon {
            font-size: 1.2rem;
        }
        
        .usage-stats {
            display: flex;
            gap: 2rem;
            font-size: 0.9rem;
            color: #6b7280;
        }
        
        .usage-bar {
            width: 100px;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 0.5rem 0;
        }
        
        .usage-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--brand-purple), var(--brand-dusty-pink));
            transition: width 0.3s ease;
        }
        
        .insights-section {
            background: linear-gradient(135deg, var(--brand-black), var(--brand-dark-purple));
            color: white;
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .insight-item {
            background: rgba(107, 70, 193, 0.2);
            border-radius: 10px;
            padding: 1rem;
            margin: 0.5rem 0;
            border-left: 4px solid var(--brand-dusty-pink);
        }
        
        .insight-title {
            font-weight: bold;
            color: var(--brand-dusty-pink);
            margin-bottom: 0.5rem;
        }
        
        .insight-text {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .export-section {
            background: var(--brand-pink-accent);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
        }
        
        .export-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
        }
        
        .export-button {
            background: var(--brand-purple);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .export-button:hover {
            background: var(--brand-dusty-pink);
            transform: scale(1.05);
        }
        
        .time-range-selector {
            background: white;
            border: 2px solid var(--brand-purple);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        
        .time-range-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .time-range-btn {
            background: white;
            color: var(--brand-purple);
            border: 2px solid var(--brand-purple);
            border-radius: 25px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .time-range-btn.active {
            background: var(--brand-purple);
            color: white;
        }
    </style>
</head>
<body>
        <!-- Streamlined Navigation Header -->
    <div id="header-placeholder"></div>

    <main class="container">
        <section class="mystical-section">
            <h1>üìä Navigation Analytics</h1>
            <p>Comprehensive analytics and insights about your navigation patterns and tool usage.</p>
            
            <!-- Time Range Selector -->
            <div class="time-range-selector">
                <h3>üìÖ Time Range</h3>
                <div class="time-range-buttons">
                    <button class="time-range-btn active" onclick="setTimeRange('7d')">Last 7 Days</button>
                    <button class="time-range-btn" onclick="setTimeRange('30d')">Last 30 Days</button>
                    <button class="time-range-btn" onclick="setTimeRange('90d')">Last 90 Days</button>
                    <button class="time-range-btn" onclick="setTimeRange('all')">All Time</button>
                </div>
            </div>
            
            <!-- Analytics Dashboard -->
            <div class="analytics-dashboard">
                <h2>üìà Navigation Metrics</h2>
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <div class="card-header">
                            <div class="card-icon">üëÜ</div>
                            <div class="card-title">Total Page Views</div>
                        </div>
                        <div class="metric-value" id="totalViews">0</div>
                        <div class="metric-label">Page views in selected period</div>
                        <div class="metric-change positive" id="viewsChange">+0% vs previous period</div>
                    </div>
                    
                    <div class="analytics-card">
                        <div class="card-header">
                            <div class="card-icon">üîÑ</div>
                            <div class="card-title">Most Visited Tool</div>
                        </div>
                        <div class="metric-value" id="mostVisited">-</div>
                        <div class="metric-label">Most frequently used tool</div>
                        <div class="metric-change" id="mostVisitedStats">0 visits</div>
                    </div>
                    
                    <div class="analytics-card">
                        <div class="card-header">
                            <div class="card-icon">‚è±Ô∏è</div>
                            <div class="card-title">Average Session</div>
                        </div>
                        <div class="metric-value" id="avgSession">0m</div>
                        <div class="metric-label">Average time per session</div>
                        <div class="metric-change positive" id="sessionChange">+0% vs previous period</div>
                    </div>
                    
                    <div class="analytics-card">
                        <div class="card-header">
                            <div class="card-icon">üéØ</div>
                            <div class="card-title">Tool Discovery</div>
                        </div>
                        <div class="metric-value" id="toolDiscovery">0%</div>
                        <div class="metric-label">Tools used vs available</div>
                        <div class="metric-change" id="discoveryChange">0 new tools this period</div>
                    </div>
                    
                    <div class="analytics-card">
                        <div class="card-header">
                            <div class="card-icon">üì±</div>
                            <div class="card-title">Mobile Usage</div>
                        </div>
                        <div class="metric-value" id="mobileUsage">0%</div>
                        <div class="metric-label">Percentage of mobile visits</div>
                        <div class="metric-change" id="mobileChange">+0% vs previous period</div>
                    </div>
                    
                    <div class="analytics-card">
                        <div class="card-header">
                            <div class="card-icon">üîç</div>
                            <div class="card-title">Search Usage</div>
                        </div>
                        <div class="metric-value" id="searchUsage">0</div>
                        <div class="metric-label">Search queries performed</div>
                        <div class="metric-change" id="searchChange">+0% vs previous period</div>
                    </div>
                </div>
            </div>
            
            <!-- Usage Patterns -->
            <div class="analytics-dashboard">
                <h2>üìä Tool Usage Patterns</h2>
                <div class="usage-table">
                    <div class="table-header">Most Used Tools</div>
                    <div id="usageTable">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Navigation Flow -->
            <div class="analytics-dashboard">
                <h2>üîÑ Navigation Flow</h2>
                <div class="chart-container">
                    <div>
                        üìä Navigation Flow Chart
                        <br><small>Shows how users move between tools</small>
                    </div>
                </div>
            </div>
            
            <!-- AI Insights -->
            <div class="insights-section">
                <h2>ü§ñ AI-Powered Insights</h2>
                <div class="insight-item">
                    <div class="insight-title">üí° Usage Optimization</div>
                    <div class="insight-text">You're using 60% of available tools. Consider exploring the Advanced Analytics and AI Assistant for more insights.</div>
                </div>
                <div class="insight-item">
                    <div class="insight-title">üìà Productivity Boost</div>
                    <div class="insight-text">Your most productive sessions are in the morning. Schedule important tasks during 9-11 AM for maximum efficiency.</div>
                </div>
                <div class="insight-item">
                    <div class="insight-title">üéØ Tool Recommendations</div>
                    <div class="insight-text">Based on your usage patterns, you might benefit from the Content Calendar and Automation Tools for workflow optimization.</div>
                </div>
                <div class="insight-item">
                    <div class="insight-title">üì± Mobile Optimization</div>
                    <div class="insight-text">40% of your usage is on mobile. Consider using the Mobile PWA features for better mobile experience.</div>
                </div>
            </div>
            
            <!-- Export Section -->
            <div class="export-section">
                <h2>üì§ Export Analytics</h2>
                <p>Download your navigation analytics for further analysis</p>
                <div class="export-buttons">
                    <button class="export-button" onclick="exportAnalytics('pdf')">üìÑ Export PDF</button>
                    <button class="export-button" onclick="exportAnalytics('csv')">üìä Export CSV</button>
                    <button class="export-button" onclick="exportAnalytics('json')">üíæ Export JSON</button>
                </div>
            </div>
        </section>
    </main>

    <script src="js/navigation/shared-navigation.js" defer></script>
    <script src="js/navigation/advanced-navigation.js" defer></script>
    <script>
        // Navigation Analytics JavaScript
        let currentTimeRange = '7d';
        
        function initializeAnalytics() {
            loadAnalyticsData();
            updateAnalyticsDisplay();
        }
        
        function setTimeRange(range) {
            currentTimeRange = range;
            
            // Update active button
            document.querySelectorAll('.time-range-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Reload analytics data
            loadAnalyticsData();
            updateAnalyticsDisplay();
        }
        
        function loadAnalyticsData() {
            // Load user data from localStorage
            const userData = JSON.parse(localStorage.getItem('nailedItUserData') || '{}');
            const navigationHistory = JSON.parse(localStorage.getItem('nailedItNavigationHistory') || '[]');
            const usageStats = JSON.parse(localStorage.getItem('nailedItUsageStats') || '{}');
            
            // Filter data by time range
            const filteredHistory = filterByTimeRange(navigationHistory, currentTimeRange);
            const filteredStats = filterStatsByTimeRange(usageStats, currentTimeRange);
            
            return {
                userData,
                navigationHistory: filteredHistory,
                usageStats: filteredStats,
                totalViews: filteredHistory.length,
                mostVisited: getMostVisitedTool(filteredStats),
                avgSession: calculateAverageSession(filteredHistory),
                toolDiscovery: calculateToolDiscovery(filteredStats),
                mobileUsage: calculateMobileUsage(filteredHistory),
                searchUsage: calculateSearchUsage(filteredHistory)
            };
        }
        
        function filterByTimeRange(history, range) {
            const now = Date.now();
            const ranges = {
                '7d': 7 * 24 * 60 * 60 * 1000,
                '30d': 30 * 24 * 60 * 60 * 1000,
                '90d': 90 * 24 * 60 * 60 * 1000,
                'all': Infinity
            };
            
            const cutoff = now - ranges[range];
            return history.filter(entry => entry.timestamp >= cutoff);
        }
        
        function filterStatsByTimeRange(stats, range) {
            // This would be more complex in a real implementation
            // For now, return all stats
            return stats;
        }
        
        function getMostVisitedTool(stats) {
            const entries = Object.entries(stats);
            if (entries.length === 0) return { tool: '-', visits: 0 };
            
            const mostVisited = entries.reduce((max, [tool, data]) => 
                data.visits > max.visits ? { tool, visits: data.visits } : max
            , { tool: '-', visits: 0 });
            
            return mostVisited;
        }
        
        function calculateAverageSession(history) {
            if (history.length === 0) return 0;
            
            // Group by session
            const sessions = {};
            history.forEach(entry => {
                if (!sessions[entry.sessionId]) {
                    sessions[entry.sessionId] = [];
                }
                sessions[entry.sessionId].push(entry);
            });
            
            // Calculate average session duration
            const sessionDurations = Object.values(sessions).map(session => {
                if (session.length < 2) return 0;
                const start = Math.min(...session.map(s => s.timestamp));
                const end = Math.max(...session.map(s => s.timestamp));
                return end - start;
            });
            
            const avgDuration = sessionDurations.reduce((sum, duration) => sum + duration, 0) / sessionDurations.length;
            return Math.round(avgDuration / 60000); // Convert to minutes
        }
        
        function calculateToolDiscovery(stats) {
            const totalTools = 15; // Total available tools
            const usedTools = Object.keys(stats).length;
            return Math.round((usedTools / totalTools) * 100);
        }
        
        function calculateMobileUsage(history) {
            // This would require device detection in the actual implementation
            // For now, return a mock value
            return 40;
        }
        
        function calculateSearchUsage(history) {
            // This would require search tracking in the actual implementation
            // For now, return a mock value
            return 12;
        }
        
        function updateAnalyticsDisplay() {
            const data = loadAnalyticsData();
            
            // Update metrics
            document.getElementById('totalViews').textContent = data.totalViews;
            document.getElementById('mostVisited').textContent = data.mostVisited.tool;
            document.getElementById('mostVisitedStats').textContent = `${data.mostVisited.visits} visits`;
            document.getElementById('avgSession').textContent = `${data.avgSession}m`;
            document.getElementById('toolDiscovery').textContent = `${data.toolDiscovery}%`;
            document.getElementById('mobileUsage').textContent = `${data.mobileUsage}%`;
            document.getElementById('searchUsage').textContent = data.searchUsage;
            
            // Update usage table
            updateUsageTable(data.usageStats);
        }
        
        function updateUsageTable(stats) {
            const usageTable = document.getElementById('usageTable');
            const sortedStats = Object.entries(stats)
                .sort(([,a], [,b]) => b.visits - a.visits)
                .slice(0, 10);
            
            const maxVisits = Math.max(...sortedStats.map(([,stats]) => stats.visits));
            
            usageTable.innerHTML = sortedStats.map(([page, data]) => {
                const percentage = (data.visits / maxVisits) * 100;
                return `
                    <div class="usage-row">
                        <div class="usage-page">
                            <span class="usage-icon">${getPageIcon(page)}</span>
                            <span>${getPageTitle(page)}</span>
                        </div>
                        <div class="usage-stats">
                            <span>${data.visits} visits</span>
                            <span>${data.frequency.toFixed(1)}/day</span>
                        </div>
                        <div class="usage-bar">
                            <div class="usage-bar-fill" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function getPageTitle(page) {
            const titles = {
                'index': 'Home',
                'overview': 'Overview',
                'planning': 'Planning',
                'tracking': 'Tracking',
                'supply': 'Supply Chain',
                'launch': 'Launch',
                'analytics': 'Analytics',
                'advanced-analytics': 'Advanced Analytics',
                'ai-assistant': 'AI Assistant',
                'automation-tools': 'Automation',
                'collaboration': 'Team',
                'mobile-pwa': 'Mobile',
                'content-calendar': 'Content Calendar',
                'pricing-calculator': 'Pricing Calculator',
                'supplier-vetting': 'Supplier Vetting'
            };
            return titles[page] || page;
        }
        
        function getPageIcon(page) {
            const icons = {
                'index': 'üè†',
                'overview': 'üé®',
                'planning': 'üì∏',
                'tracking': 'üìä',
                'supply': 'üì¶',
                'launch': 'üöÄ',
                'analytics': 'üìà',
                'advanced-analytics': 'üöÄ',
                'ai-assistant': 'ü§ñ',
                'automation-tools': '‚ö°',
                'collaboration': 'üë•',
                'mobile-pwa': 'üì±',
                'content-calendar': 'üìÖ',
                'pricing-calculator': 'üí∞',
                'supplier-vetting': 'üîç'
            };
            return icons[page] || 'üìÑ';
        }
        
        function exportAnalytics(format) {
            const data = loadAnalyticsData();
            
            switch (format) {
                case 'pdf':
                    alert('Exporting analytics to PDF...');
                    break;
                case 'csv':
                    exportToCSV(data);
                    break;
                case 'json':
                    exportToJSON(data);
                    break;
            }
        }
        
        function exportToCSV(data) {
            const csv = [
                'Tool,Visits,Frequency,Last Visit',
                ...Object.entries(data.usageStats).map(([page, stats]) => 
                    `${getPageTitle(page)},${stats.visits},${stats.frequency.toFixed(2)},${new Date(stats.lastVisit).toLocaleDateString()}`
                )
            ].join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `navigation-analytics-${currentTimeRange}.csv`;
            a.click();
        }
        
        function exportToJSON(data) {
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `navigation-analytics-${currentTimeRange}.json`;
            a.click();
        }
        
        // Initialize analytics
        document.addEventListener('DOMContentLoaded', function() {
            initializeAnalytics();
        });
    </script>
    <!-- Streamlined Navigation Scripts -->
    <script src="js/navigation/streamlined-navigation.js" defer></script>
</body>
</html>
